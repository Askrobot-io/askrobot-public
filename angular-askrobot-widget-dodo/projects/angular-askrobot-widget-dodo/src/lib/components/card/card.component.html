<div *ngIf="clientId && token" class="askrobot-card" [ngClass]="getThemeClass()">
    <ng-container *ngIf="!this.isLoading">
        <div class="card-wrapper">
            <askrobot-logo-icon [color]="getLogoColor()"></askrobot-logo-icon>

            <div>
                <div class="first-block">
                    <div class="title" [ngClass]="getThemeClass()">
                        {{question}}
                    </div>
                    <div
                        *ngIf="isStandard !== null"
                        class="status"
                        [class.is-standard]="isStandard"
                    >
                        {{isStandard ? "–°—Ç–∞–Ω–¥–∞—Ä—Ç" : "–°—Ç–∞—Ç—å—è"}}
                    </div>
                </div>


                <div *ngIf="showWarning" class="warning" [ngClass]="getThemeClass()">
                    <warning-icon [color]="getIconColor()"></warning-icon>

                    <span>
                        –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –î–æ–¥–æ
                    </span>

                </div>

                <div
                    *ngIf="answer"
                    class="answer"
                    [ngClass]="getThemeClass()"
                    [class.expanded]="expanded"
                    [innerHTML]="answer | markdown"
                    [style.-webkitLineClamp]="previewAnswerLines"
                >
                </div>

            </div>
        </div>
        <actions
            *ngIf="expanded && !showRatingBlock && !isStreaming" [theme]="getThemeClass()"
            [mainButtonText]="showSearch ? '–ù–∞–π—Ç–∏ –≤ —Å—Ç–∞—Ç—å—è—Ö' : ''"
            [mainButtonIcon]="searchIcon"
            (mainButtonAction)="searchClick()"
            [secondaryButtonText]="!ratingSubmitted ? '–û—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç' : ''"
            [secondaryButtonIcon]="ratingIcon"
            [secondaryButtonComponent]="ratingSubmitted ? ratingStars : null"
            (secondaryButtonAction)="ratingBlockClick()"
        >
        </actions>

        <ng-container *ngIf="showRatingBlock">
            <ng-container *ngTemplateOutlet="ratingBlock">
            </ng-container>
        </ng-container>

        <div *ngIf="!expanded" class="expand" [ngClass]="getThemeClass()">
            <button *ngIf="isExpandable" class="expand-btn" (click)="toggleExpand()">
                <arrowdown-icon [color]="getIconColor()"></arrowdown-icon>
            </button>
        </div>
    </ng-container>

    <ng-container *ngIf="isLoading">
        <div class="loader-wrapper">
            <askrobot-logo-icon [color]="getLogoColor()"></askrobot-logo-icon>
            <div class="loader" [ngClass]="getThemeClass()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </ng-container>
</div>


<ng-template #searchIcon>
    <search-icon [color]="getSearchIconColor()"></search-icon>
</ng-template>

<ng-template #ratingIcon>
    <rating-icon [color]="getIconColor()"></rating-icon>
</ng-template>

<ng-template #ratingStars>
    <div class="rating-stars">
        <div
            *ngFor="let item of [1, 2, 3, 4, 5]; let i = index"
        >
            <span [ngClass]="{'hide': i > rating}">
                <filled-star-icon [color]="getFilledStarColor()"></filled-star-icon>
            </span>
            <span [ngClass]="{'hide': i <= rating}">
                <star-icon></star-icon>
            </span>
        </div>
    </div>
</ng-template>

<ng-template #ratingBlock>
    <div class="rating-block" [ngClass]="getThemeClass()">
        <form *ngIf="!ratingSuccessBlock" (ngSubmit)="ratingClick()">
            <div>
                <div>
                    –í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ –æ—Ç–≤–µ—Ç–∞
                </div>
                <div class="stars">
                    <button
                        *ngFor="let item of [1, 2, 3, 4, 5]; let i = index"
                        (mouseover)="onStarHover(i)"
                        (mouseleave)="onStarLeave()"
                        (click)="onStarClick(i)"
                        type="button"
                    >
                        <span [ngClass]="{'hide': i > hoverRating}">
                            <filled-star-icon [color]="getFilledStarColor()"></filled-star-icon>
                        </span>
                        <span [ngClass]="{'hide': i <= hoverRating}">
                            <star-icon></star-icon>
                        </span>
                    </button>
                </div>
            </div>

            <div>
                <div>
                    –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ
                </div>
                <textarea
                    class="textarea"
                    [ngClass]="getThemeClass()"
                    name="comment"
                    rows="3"
                    cols="30"
                    placeholder="–ü–æ—á–µ–º—É –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é, –æ—Ç–≤–µ—Ç –≤–∞–º –Ω–µ¬†–ø–æ–¥–æ—à–µ–ª?"
                    [(ngModel)]="comment"
                ></textarea>
            </div>

            <div class="actions">
                <actions
                    [theme]="getThemeClass()"
                    [mainButtonText]="'–û—Ü–µ–Ω–∏—Ç—å'"
                    (mainButtonAction)="ratingClick()"
                    [secondaryButtonText]="'–û—Ç–º–µ–Ω–∞'"
                    (secondaryButtonAction)="ratingCancelClick()"
                    [hasBackground]="false"
                >
                </actions>
            </div>
        </form>

        <div *ngIf="ratingSuccessBlock" class="sucess-block">
            <div class="title">
                –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!
            </div>
            <span class="emoji">
                üëç
            </span>

        </div>
    </div>
</ng-template>