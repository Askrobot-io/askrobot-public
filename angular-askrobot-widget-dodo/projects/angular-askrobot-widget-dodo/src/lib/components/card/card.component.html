<div class="askrobot-card" [ngClass]="getThemeClass()">
    <ng-container *ngIf="!(this.isLoading || this.showSearchConfirmation)">
        <div
            *ngIf="statusText"
            class="status"
            [ngStyle]="{'backgroundColor': statusBgColor, 'color': statusColor }"
        >
            {{statusText}}
        </div>
        <div class="card-wrapper">
            <askrobot-logo-icon [color]="getLogoColor()"></askrobot-logo-icon>

            <div>
                <div class="title" [ngClass]="getThemeClass()">
                    {{title}}
                </div>


                <div *ngIf="warningText" class="warning" [ngClass]="getThemeClass()">
                    <warning-icon [color]="getIconColor()"></warning-icon>

                    <span>
                        {{warningText}}
                    </span>

                </div>

                <div
                    class="description"
                    [ngClass]="getThemeClass()"
                    [class.expanded]="expanded"
                    [innerHTML]="description | sanitiser" [style.-webkitLineClamp]="previewDescriptionLines"
                >
                </div>

                <actions
                    *ngIf="expanded && !showRatingBlock" [theme]="getThemeClass()"
                    [mainButtonText]="showSearch ? '–ü–æ–∏—Å–∫–∞—Ç—å –≤ —Å—Ç–∞—Ç—å—è—Ö' : ''"
                    [mainButtonComponent]="searchIcon"
                    (mainButtonAction)="searchConfirmationClick()"
                    [secondaryButtonText]="showRating ? '–û—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç' : ''"
                    [secondaryButtonComponent]="ratingIcon"
                    (secondaryButtonAction)="ratingBlockClick()"
                >
                </actions>
            </div>
        </div>

        <ng-container *ngIf="showRatingBlock">
            <ng-container *ngTemplateOutlet="ratingBlock">
            </ng-container>
        </ng-container>

        <div *ngIf="!expanded" class="expand" [ngClass]="getThemeClass()">
            <button *ngIf="isExpandable" class="expand-btn" (click)="toggleExpand()">
                <arrowdown-icon [color]="getIconColor()"></arrowdown-icon>
            </button>
        </div>
    </ng-container>

    <ng-container *ngIf="isLoading">
        <div class="loader-wrapper">
            <askrobot-logo-icon [color]="getLogoColor()"></askrobot-logo-icon>
            <div class="loader" [ngClass]="getThemeClass()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="showSearchConfirmation">
        <div class="card-wrapper">
            <askrobot-logo-icon [color]="getLogoColor()"></askrobot-logo-icon>
            <div>
                <div class="title no-underline" [ngClass]="getThemeClass()">
                    –í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∏—Å–∫–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ —Å—Ç–∞—Ç—å—è—Ö?
                </div>

                <div class="block">
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —Å—Ç–∞—Ç—å—è—Ö –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –î–æ–¥–æ!
                </div>

                <actions
                    [theme]="getThemeClass()"
                    [mainButtonText]="'–î–∞, –∏—Å–∫–∞—Ç—å –≤ —Å—Ç–∞—Ç—å—è—Ö'"
                    [mainButtonComponent]="searchIcon"
                    (mainButtonAction)="searchClick()"
                    [secondaryButtonText]="'–û—Ç–º–µ–Ω–∞'"
                    (secondaryButtonAction)="searchCancelClick()"
                >
                </actions>
            </div>
        </div>
    </ng-container>
</div>


<ng-template #searchIcon>
    <search-icon [color]="getSearchIconColor()"></search-icon>
</ng-template>

<ng-template #ratingIcon>
    <rating-icon [color]="getIconColor()"></rating-icon>
</ng-template>

<ng-template #ratingBlock>
    <div class="rating-block" [ngClass]="getThemeClass()">
        <form *ngIf="!ratingSuccessBlock" (ngSubmit)="ratingClick()">
            <div>
                <div>
                    –í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ –æ—Ç–≤–µ—Ç–∞
                </div>
                <div class="stars">
                    <button
                        *ngFor="let item of [1, 2, 3, 4, 5]; let i = index"
                        (mouseover)="onStarHover(i)"
                        (mouseleave)="onStarLeave()"
                        (click)="onStarClick(i)"
                    >
                        <span [ngClass]="{'hide': i > hoverRating}">
                            <filled-star-icon [color]="getIconColor()"></filled-star-icon>
                        </span>
                        <span [ngClass]="{'hide': i <= hoverRating}">
                            <star-icon [color]="getIconColor()"></star-icon>
                        </span>
                    </button>
                </div>
            </div>

            <div>
                <div>
                    –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ—Ü–µ–Ω–∫–µ
                </div>
                <textarea
                    class="textarea"
                    [ngClass]="getThemeClass()"
                    name="comment"
                    rows="5"
                    cols="30"
                    [(ngModel)]="comment"
                ></textarea>
            </div>

            <actions
                [theme]="getThemeClass()"
                [mainButtonText]="'–û—Ü–µ–Ω–∏—Ç—å'"
                (mainButtonAction)="ratingClick()"
                [secondaryButtonText]="'–û—Ç–º–µ–Ω–∞'"
                (secondaryButtonAction)="ratingCancelClick()"
            >
            </actions>
        </form>

        <div *ngIf="ratingSuccessBlock" class="sucess-block">
            <div class="title">
                –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!
            </div>
            <span class="emoji">
                üëç
            </span>

        </div>
    </div>
</ng-template>